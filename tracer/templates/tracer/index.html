{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>17D Example route</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="{%static 'tracer/css/leaflet-routing-machine.css' %}" />
    <link rel="stylesheet" href="{%static 'tracer/css/Control.Geocoder.css' %}">
    <style>
        .map {
            position: absolute;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map" class="map"></div>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="{% static 'tracer/js/leaflet-routing-machine.js' %}"></script>
    <script src="{%static 'tracer/js/Control.Geocoder.js' %}"></script>
    <script>
        var waypoints = [
            {
                name: "04L",
                routes: [
                  L.latLng(10.309699, 123.918396),
                  L.latLng(10.309556, 123.918514),
                  L.latLng(10.309028, 123.919417),
                  L.latLng(10.310921, 123.921549),
                  L.latLng(10.312082, 123.920583),
                  L.latLng(10.313507, 123.917600),
                  L.latLng(10.312378, 123.916291),
                  L.latLng(10.314151, 123.914768),
                  L.latLng(10.320523, 123.910883),
                  L.latLng(10.325865, 123.907553),
                  L.latLng(10.328873, 123.902779),
                  L.latLng(10.331121, 123.898219),
                  L.latLng(10.328778, 123.897405),
                  L.latLng(10.324334, 123.898317),
                  L.latLng(10.320166, 123.899261),
                  L.latLng(10.318530, 123.899926),
                  L.latLng(10.320367, 123.903617),
                  L.latLng(10.320029, 123.905763),
                  L.latLng(10.318414, 123.907913),
                  L.latLng(10.320567, 123.910713),
                  L.latLng(10.314763, 123.914483),
                  L.latLng(10.314763, 123.914483),
                  L.latLng(10.311723, 123.916725),
                  L.latLng(10.309699, 123.918396),
                ]
            },
            {
                name: "03Q",
                routes: [
                  L.latLng(10.309727, 123.918496),
                  L.latLng(10.310228, 123.918088),
                  L.latLng(10.310228, 123.918088),
                  L.latLng(10.311466, 123.917020),
                  L.latLng(10.312123, 123.916508),
                  L.latLng(10.312725, 123.916012),
                  L.latLng(10.313385, 123.915374),
                  L.latLng(10.314187, 123.914821),
                  L.latLng(10.314804, 123.914448),
                  L.latLng(10.314804, 123.914448),
                  L.latLng(10.320423, 123.910969),
                  L.latLng(10.320368, 123.910261),
                  L.latLng(10.318680, 123.908040),
                  L.latLng(10.318680, 123.908040),
                  L.latLng(10.318223, 123.907971),
                  L.latLng(10.315680, 123.908214),
                  L.latLng(10.316342, 123.905396),
                  L.latLng(10.317725, 123.902727),
                  L.latLng(10.320311, 123.903854),
                  L.latLng(10.319081, 123.904015),
                  L.latLng(10.315605, 123.908356),
                  L.latLng(10.318188, 123.908228),
                  L.latLng(10.312634, 123.916633),
                  L.latLng(10.309727, 123.918496),
                ]
            },
            {
                name: "04C",
                routes: [
	                L.latLng(10.333883, 123.901668),
	                L.latLng(10.333376, 123.902423),
	                L.latLng(10.332410, 123.901752),
	                L.latLng(10.332969, 123.900931),
	                L.latLng(10.332895, 123.900876),
	                L.latLng(10.331106, 123.898274),
	                L.latLng(10.330826, 123.897947),
	                L.latLng(10.324852, 123.898200),
	                L.latLng(10.311370, 123.903601),
	                L.latLng(10.310863, 123.903719),
	                L.latLng(10.310433, 123.895745),
	                L.latLng(10.304562, 123.898160),
	                L.latLng(10.298937, 123.899927),
	                L.latLng(10.295920, 123.892949),
	                L.latLng(10.293387, 123.896637),
	                L.latLng(10.293613, 123.897749),
	                L.latLng(10.293342, 123.898633),
	                L.latLng(10.292227, 123.900139),
	                L.latLng(10.292590, 123.902405),
	                L.latLng(10.294633, 123.903937),
        					L.latLng(10.295821, 123.901851),
        					L.latLng(10.305117, 123.899908),
        					L.latLng(10.305460, 123.897735),
        					L.latLng(10.311015, 123.903100),
	                L.latLng(10.333883, 123.901668),
                ]
            },
            {
            	name: "04M",
            	routes: [
            		L.latLng(10.319473, 123.903519),
    		    		L.latLng(10.318842, 123.902977),
    		    		L.latLng(10.320427, 123.899217),
    		    		L.latLng(10.330340, 123.899744),
    		    		L.latLng(10.326041, 123.907387),
    		    		L.latLng(10.319473, 123.903519),
            	]
            },
            {
            	name: "04H",
            	routes: [
            		L.latLng(10.356760, 123.884038),
              	L.latLng(10.318608, 123.899221),
                L.latLng(10.313476, 123.891773),
                L.latLng(10.297499, 123.896669),
                L.latLng(10.294639, 123.894072),
                L.latLng(10.292463, 123.898235),
                L.latLng(10.292385, 123.902915),
                L.latLng(10.294608, 123.903954),
                L.latLng(10.298031, 123.897977),
                L.latLng(10.300395, 123.896556),
                L.latLng(10.356760, 123.884038),
            	]
            },
            {
            	name: "12L",
            	routes: [
	            	L.latLng(10.319141, 123.903361),
                L.latLng(10.318835, 123.902940),
                L.latLng(10.321075, 123.901581),
                L.latLng(10.318584, 123.899224),
                L.latLng(10.300593, 123.878502),
                L.latLng(10.298461, 123.869752),
                L.latLng(10.296597, 123.874487),
                L.latLng(10.299520, 123.878912),
                L.latLng(10.296782, 123.886042),
                L.latLng(10.307932, 123.887060),
                L.latLng(10.311554, 123.903615),
                L.latLng(10.314852, 123.905402),
                L.latLng(10.319141, 123.903361),
            	]
            },
            {
            	name: "13C",
            	routes: [
	            	L.latLng(10.370995, 123.924670),
                L.latLng(10.353758, 123.914315),
                L.latLng(10.320047, 123.904676),
                L.latLng(10.315682, 123.908226),
                L.latLng(10.315620, 123.901734),
                L.latLng(10.311408, 123.903608),
                L.latLng(10.309137, 123.903441),
                L.latLng(10.304846, 123.901628),
                L.latLng(10.297972, 123.903564),
                L.latLng(10.296806, 123.899095),
                L.latLng(10.300268, 123.898190),
                L.latLng(10.311976, 123.909802),
                L.latLng(10.318022, 123.908415),
                L.latLng(10.320693, 123.904106),
                L.latLng(10.370995, 123.924670),
	            ]
            },
            {
            	name: "13B",
            	routes: [
            		L.latLng(10.370995, 123.924670),
                L.latLng(10.353758, 123.914315),
                L.latLng(10.320047, 123.904676),
                L.latLng(10.315682, 123.908226),
                L.latLng(10.315620, 123.901734),
                L.latLng(10.311408, 123.903608),
                L.latLng(10.309137, 123.903441),
                L.latLng(10.306102, 123.899788),
                L.latLng(10.297722, 123.900556),
                L.latLng(10.297284, 123.903779),
                L.latLng(10.292558, 123.898549),
                L.latLng(10.292083, 123.899850),
                L.latLng(10.293469, 123.901205),
                L.latLng(10.306102, 123.899788),
                L.latLng(10.305859, 123.901288),
                L.latLng(10.315620, 123.901734),
                L.latLng(10.316990, 123.906443),
                L.latLng(10.319129, 123.907110),
                L.latLng(10.370995, 123.924670),
            	]
            },
            {
            	name: "14D",
            	routes: [
            		L.latLng(10.340498, 123.906306),
                L.latLng(10.319646, 123.903271),
                L.latLng(10.321075, 123.901581),
                L.latLng(10.318584, 123.899224),
                L.latLng(10.314981, 123.891264),
                L.latLng(10.309172, 123.894911),
                L.latLng(10.297745, 123.900524),
                L.latLng(10.297376, 123.903775),
                L.latLng(10.295793, 123.899505),
                L.latLng(10.316030, 123.891016),
                L.latLng(10.318960, 123.902863),
                L.latLng(10.319141, 123.903361),
            	]
            },
            {
            	name: "17B",
            	routes: [
	            	L.latLng(10.340498, 123.906306),
  	        		L.latLng(10.336344, 123.907881),
  	        		L.latLng(10.331031, 123.908127),
  	        		L.latLng(10.330490, 123.906341),
  	        		L.latLng(10.328385, 123.903781),
  	        		L.latLng(10.310813, 123.892773),
  	        		L.latLng(10.293803, 123.898090),
  	        		L.latLng(10.292684, 123.898610),
  	        		L.latLng(10.293190, 123.904459),
  	        		L.latLng(10.294467, 123.904019),
  	        		L.latLng(10.300106, 123.898055),
  	        		L.latLng(10.309096, 123.893530),
  	        		L.latLng(10.318513, 123.899604),
  	        		L.latLng(10.325511, 123.898144),
  	        		L.latLng(10.328385, 123.903781),
  	        		L.latLng(10.328951, 123.905256),
  	        		L.latLng(10.330155, 123.906707),
  	        		L.latLng(10.331205, 123.908111),
                L.latLng(10.340498, 123.906306),
	            ]
            },
            {
            	name: "17C",
            	routes: [
	            	L.latLng(10.340498, 123.906306),
  	        		L.latLng(10.336344, 123.907881),
  	        		L.latLng(10.331031, 123.908127),
  	        		L.latLng(10.330490, 123.906341),
  	        		L.latLng(10.328385, 123.903781),
  	        		L.latLng(10.311947, 123.903369),
  	        		L.latLng(10.308512, 123.895415),
  	        		L.latLng(10.298736, 123.899561),
  	        		L.latLng(10.295074, 123.893688),
  	        		L.latLng(10.292129, 123.899235),
  	        		L.latLng(10.293744, 123.903687),
  	        		L.latLng(10.295729, 123.901820),
  	        		L.latLng(10.305151, 123.899684),
  	        		L.latLng(10.308512, 123.895415),
  	        		L.latLng(10.311947, 123.903369),
  	        		L.latLng(10.322017, 123.898860),
  	        		L.latLng(10.328385, 123.903781),
  	        		L.latLng(10.328951, 123.905256),
  	        		L.latLng(10.330155, 123.906707),
  	        		L.latLng(10.331205, 123.908111),
                L.latLng(10.340498, 123.906306),
	            ]
            },
            {
            	name: "17D",
            	routes: [
            		L.latLng(10.340498, 123.906306),
  	        		L.latLng(10.336344, 123.907881),
  	        		L.latLng(10.331031, 123.908127),
  	        		L.latLng(10.330490, 123.906341),
  	        		L.latLng(10.328385, 123.903781),
  	        		L.latLng(10.319467, 123.898930),
  	        		L.latLng(10.315961, 123.890862),
  	        		L.latLng(10.297685, 123.897314),
  	        		L.latLng(10.292608, 123.892583),
  	        		L.latLng(10.292344, 123.898611),
  	        		L.latLng(10.292392, 123.900945),
  	        		L.latLng(10.292497, 123.903101),
  	        		L.latLng(10.294692, 123.903852),
  	        		L.latLng(10.300118, 123.898039),
  	        		L.latLng(10.309180, 123.893483),
  	        		L.latLng(10.316800, 123.892595),
  	        		L.latLng(10.323109, 123.898640),
  	        		L.latLng(10.328951, 123.905256),
  	        		L.latLng(10.330155, 123.906707),
  	        		L.latLng(10.331205, 123.908111),
                L.latLng(10.340498, 123.906306),
            	]
            }
        ];
        var map = L.map('map');
        var routes = [];

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        control = L.Routing.control({
            waypoints: [
            	L.latLng(10.340498, 123.906306),
          		L.latLng(10.336344, 123.907881),
          		L.latLng(10.331031, 123.908127),
          		L.latLng(10.330490, 123.906341),
          		L.latLng(10.328385, 123.903781),
          		L.latLng(10.319467, 123.898930),
          		L.latLng(10.315961, 123.890862),
          		L.latLng(10.297685, 123.897314),
          		L.latLng(10.292608, 123.892583),
          		L.latLng(10.292344, 123.898611),
          		L.latLng(10.292392, 123.900945),
          		L.latLng(10.292497, 123.903101),
          		L.latLng(10.294692, 123.903852),
          		L.latLng(10.300118, 123.898039),
          		L.latLng(10.309180, 123.893483),
          		L.latLng(10.316800, 123.892595),
          		L.latLng(10.323109, 123.898640),
          		L.latLng(10.328951, 123.905256),
          		L.latLng(10.330155, 123.906707),
          		L.latLng(10.331205, 123.908111),
              L.latLng(10.340498, 123.906306),
            ],
            routeWhileDragging: true,
            geocoder: L.Control.Geocoder.nominatim(),
            router: L.Routing.mapbox('pk.eyJ1IjoiamFjZXJvbGRhbiIsImEiOiJjamp6dDM0OTgwZmJ6M3B0eTZyNmhkaWZ6In0.jdkab4YMJJKdrI5rz_bzLg')
        })
        .on('routeselected', function(e) {
          var route = e.route;
          var polyline = L.polyline(route.coordinates, {color: 'blue'}).addTo(map);
          routes.push(polyline);
          map.removeControl(control);
        })
        .addTo(map);

        map.on('click', function(e) {
          var marker = L.marker(e.latlng).addTo(map);
          marker.bindPopup(`lat: ${e.latlng.lat}, lng: ${e.latlng.lng}`);

          var closestPoint = routes[0].closestLayerPoint(e.layerPoint);
          var closestLatLng = map.layerPointToLatLng(closestPoint);

          marker = L.marker([closestLatLng.lat, closestLatLng.lng]).addTo(map);
          marker.bindPopup(`lat: ${closestLatLng.lat}, lng: ${closestLatLng.lng}`);
        });
    </script>
</body>
</html>
